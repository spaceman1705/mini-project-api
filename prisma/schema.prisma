generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  ADMIN
  CUSTOMER
  ORGANIZER
}

enum TransactionStatus {
  WAITING_PAYMENT
  WAITING_CONFIRMATION
  DONE
  REJECTED
  EXPIRED
  CANCELED
}

enum NotificationType {
  TRANSACTION
  SYSTEM
  REWARD
}

model User {
  id              String            @id @default(uuid())
  firstname       String
  lastname        String
  email           String            @unique
  password        String
  role            Role              @default(CUSTOMER)
  referralCode    String?           @unique
  referredBy      String?
  pointsBalance   Int               @default(0)
  createdAt       DateTime          @default(now())
  user_img        String?

  // Relations
  events          Event[]           @relation("OrganizerEvents")
  transactions    Transaction[]
  notifications   Notification[]
  pointsHistory   PointsHistory[]
  vouchers        Voucher[]
}

model Event {
  id             Int                @id @default(autoincrement())
  title          String
  description    String?
  location       String?
  startDate      DateTime
  endDate        DateTime
  availableSeats Int
  price          Float
  status         String             @default("active")
  createdAt      DateTime           @default(now())

  // Relation ke Organizer
  organizer      User               @relation("OrganizerEvents", fields: [organizerId], references: [id])
  organizerId    String

  // Relation ke transaksi
  transactions   Transaction[]
}

model Transaction {
  id             Int                 @id @default(autoincrement())
  totalPrice     Float
  status         TransactionStatus   @default(WAITING_PAYMENT)
  paymentProof   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  // Relation
  user           User                @relation(fields: [userId], references: [id])
  userId         String
  event          Event               @relation(fields: [eventId], references: [id])
  eventId        Int
  details        TransactionDetail[]
}

model TransactionDetail {
  id              Int          @id @default(autoincrement())
  ticketQuantity  Int
  pricePerTicket  Float
  transaction     Transaction  @relation(fields: [transactionId], references: [id])
  transactionId   Int
}

model Notification {
  id         Int               @id @default(autoincrement())
  title      String
  message    String
  type       NotificationType
  isRead     Boolean           @default(false)
  createdAt  DateTime          @default(now())

  user       User              @relation(fields: [userId], references: [id])
  userId     String
}

model PointsHistory {
  id          Int        @id @default(autoincrement())
  points      Int
  source      String
  expiresAt   DateTime
  createdAt   DateTime   @default(now())

  user        User       @relation(fields: [userId], references: [id])
  userId      String
}

model Voucher {
  id              Int        @id @default(autoincrement())
  code            String     @unique
  discountAmount  Float
  isUsed          Boolean    @default(false)
  expiresAt       DateTime
  createdAt       DateTime   @default(now())

  user            User       @relation(fields: [userId], references: [id])
  userId          String
}

model RegisterToken {
  id Int @id @default(autoincrement())
  token String @unique
}